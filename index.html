<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>신발 감지</title>

<!-- TensorFlow.js & COCO-SSD -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<style>
  body { margin:0; background:#111; color:#fff; font-family:Arial, sans-serif; text-align:center; }
  video { width:100%; max-width:600px; border:1px solid #333; }
  #info { padding:10px; font-size:18px; white-space:pre-line; text-align:center; }
  #startBtn { margin:10px; padding:10px 18px; font-size:16px; border-radius:8px; background:#333; color:#fff; border:none; }
</style>
</head>
<body>

<h1>신발 감지 전용</h1>
<p>버튼을 눌러 카메라 시작 후 신발 감지</p>
<button id="startBtn">카메라 시작</button>
<br>
<video id="camera" autoplay playsinline></video>
<div id="info">시작 버튼을 눌러주세요</div>

<script>
const startBtn = document.getElementById('startBtn');
const video = document.getElementById('camera');
const info = document.getElementById('info');

let model = null;
let running = false;

startBtn.addEventListener('click', async () => {
  startBtn.style.display = 'none';
  info.innerText = '카메라 권한 요청 중...';

  try {
    // 휴대폰 후면 카메라
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
    video.srcObject = stream;

    info.innerText = '모델 로드 중...';
    model = await cocoSsd.load();

    info.innerText = '카메라에 신발을 비춰주세요!';
    running = true;
    detectLoop();
  } catch(e) {
    console.error(e);
    info.innerText = '카메라 권한 필요 또는 에러 발생';
  }
});

async function detectLoop() {
  if(!running || !model) return;

  const predictions = await model.detect(video);
  let outText = '';
  const seen = new Set();

  predictions.sort((a,b) => b.score - a.score);
  for(const p of predictions){
    const label = p.class;
    // COCO-SSD에서는 신발을 "sports shoe"로 인식
    if(label==='sports shoe' && !seen.has(label)){
      outText += `[신발]\n감지됨\n\n`;
      seen.add(label);
    }
  }

  info.innerText = outText || '등록된 신발이 없습니다.';
  requestAnimationFrame(detectLoop);
}
</script>

</body>
</html>
